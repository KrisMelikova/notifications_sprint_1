# Архитектура системы нотификаций

## Описание
Сервис предназначен для обработки и отправки уведомлений пользователям

## Основные компоненты

### Notifications API
- Основной интерфейс взаимодействия с системой
- Принимает события от существующих сервисов (Auth Service, UGC Service и т.д.)
- Управляет событиями и статусами отправки в БД MongoDB
- Отправляет (публикует) события в очередь Raw Events

### Scheduler Service (Airflow)
- Генерирует события по расписанию
- Взаимодействует с системой через Notifications API

### Очереди сообщений (RabbitMQ)
1. **Raw Events** - очередь необработанных событий
2. **Enriched Events** - очередь сообщений, которые были обработаны и дополнены данными пользователей (для персонификации нотификаций)
3. **Dead Letter Queue** - очередь для обработки ошибочных сообщений (см. https://www.rabbitmq.com/docs/dlx)

### Воркеры
1. **Enrichment Worker**
   - Забирает события из Raw Events
   - Дополняет данные информацией о пользователе через сервис аутентификации
   - Отправляет обработанные события в Enriched Events

2. **Sender Worker**
   - Забирает события из Enriched Events
   - Отправляет уведомления пользователям
   - Сохраняет результаты отправки в NotificationTable

### База данных (MongoDB)
- **EventTable**: информация о событиях
- **NotificationTable**: информация об уведомлениях


## Процесс обработки уведомлений

1. События поступают в систему через Notification API от внешних сервисов или шедулера
2. События публикуются в очередь Raw Events
3. Enrichment Worker дополняет события данными о пользователе
4. Обогащенные события публикуются в очередь Enriched Events
5. Sender Worker обрабатывает события из Enriched Events и отправляет уведомления пользователям
6. В случае ошибок, события направляются в Dead Letter Queue для последующей обработки
